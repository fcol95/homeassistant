# Moes BHT-002 GB WF Smart Thermostat
Create a new yaml file for each device by copying "plug-sonoff-s31-example.yaml".
The keys and passwords to replace can be auto-generated by HA esphome builder, by created new device, esp8266, and name it accordingly.
Then you can copy the example in their and just keep the generated keys.
You can also set the recovery state by device with switch_restore_mode.

## Dissassembly Notes
1. IC Descriptions:
	1.1. U2 - Wifi SOM: WB3S.
		https://developer.tuya.com/en/docs/iot/wb3s-module-datasheet?id=K9dx20n6hz5n4
		https://docs.libretiny.eu/boards/wb3s/#usage
	1.2. U3 - Touch Controller: SC05A.
		https://wmsc.lcsc.com/wmsc/upload/file/pdf/v2/lcsc/1809131515_ICMAN-Tech-SC05A_C96168.pdf
	1.3. U6 - LCD Controller:
		https://www.lcsc.com/datasheet/lcsc_datasheet_2304140030_TM-Shenzhen-Titan-Micro-Elec-TM1621_C41326.pdf
	1.4. U7 - 92F Series Touch MCU: sc92f8463bx
		https://www.socmcu.com/cn/product_show.php?id=34
2. Power Circuit:
	2.1. Relay: https://www.hongfa.com/Product/power-relay/HF115F
3. Connectors:
	1. J5 - MCU Uart
		1.1. Pin1: 5V?
		1.2. Pin2: MCU RX.
		1.3. Pin3: GND.
		1.4. Pin4: MCU TX.

## References

Buy link: https://www.aliexpress.com/item/4000415736135.html.

## Flashing instructions with ESPtool:
Ref: https://www.elektroda.com/rtvforum/topic4003974.html
1. Dissassemble thermostat.
2. Extract original firmware for backup:
    1. pip install ltchiptool[gui].
        Or download latest release exe from git https://github.com/libretiny-eu/ltchiptool
    2. Connect USB to UART to WB3S RX/TX in 3.3V mode and J5 pin1 to 5V output of adapter and pin3 to GND.
    3. Dump original firmware:
        3.1. In GUI, "read flash" with Beken 72xx family.
4. Install new esphome firmware (ensure not space in path where you compile!):
	pip install esphome
	pip install ltchiptool
	esphome compile thermostat-moes-bht-002-gb-example.yaml
5. Flash on device with ltchiptool GUI:
	ltchiptool flash write -d COM10 .\.esphome\build\thermostat-moes-bht-002-gb-example\.pioenvs\thermostat-moes-bht-002-gb-example\firmware.bin
