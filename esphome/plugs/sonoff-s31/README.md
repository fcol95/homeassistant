# Sonoff S31 Smart Plug ESPHome Config
Create a new yaml file for each device by copying "plug-sonoff-s31-example.yaml".
The keys and passwords to replace can be auto-generated by HA esphome builder, by created new device, esp8266, and name it accordingly.
Then you can copy the example in their and just keep the generated keys.

# References
This config has been inspired by:
- https://devices.esphome.io/devices/Sonoff-S31.
- https://community.home-assistant.io/t/sonoff-s31-outlet-with-esphome-example-yaml/434828.

It has been modified to be use with subsitutions and templates for ease of duplication and versionning.

Buy link: https://www.aliexpress.com/item/32847534626.html.

# Flashing instructions with ESPtool:
1. Open case:
	1.1. Pop gray cap on the button side.
	1.2. Slide the white corners out.
	1.3. Unscrew the 3 screws.
2. Connect the USB to UART adapter (3.3V and Tx to Rx and vice versa).
3. Install esptool and esphome:
	pip install esptool esphome
4. Optional: Backup the original firmware (replace COM port!):
	esptool -p COM8 -b 115200 read_flash 0 ALL backup.bin
5. Build the binary with esphome and the yaml config:
	5.1. Check "secrets.yaml" to put the WIFI SSID and password.
	5.2. Create a device specific yaml to have a dedicated name (check plug-sonoff-s31-example.yaml as example).
	5.3. Compile:
	esphome compile plug-sonoff-s31-example.yaml
6. Flash with esptool (replace path with device name!):
	Power up the device while holding the side button, then:
	
	esptool --port COM18 --baud 115200 write_flash 0x0 "./plug-sonoff-s31-example.bin" --flash_mode dout
